<!DOCTYPE html>
<html lang="tr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PiÅŸti </title>
  <style>
    :root {
      --bg: #fff0f6;
      --primary: #ff85c0;
      --primary-dark: #f759ab;
      --accent: #ffadd2;
      --text: #780650;
      --card-bg: #ffffff;
      --shadow: 0 8px 20px rgba(255, 133, 192, 0.2);
    }

    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: var(--bg);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    /* BaÅŸlÄ±k Stili */
    .game-header {
      width: 100%;
      text-align: center;
      padding: 15px 0;
      background:  rgb(255, 133, 192);
      box-shadow: 0 2px 10px rgb(255, 133, 192);
      margin-bottom: 10px;
    }

    .game-header h1 {
      margin: 0;
      font-size: 1.8rem;
      color: white;
      text-transform: uppercase;
      letter-spacing: 2px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .game-container {
      width: 95%;
      max-width: 1000px;
      display: grid;
      grid-template-rows: 140px 1fr 160px;
      gap: 15px;
      height: calc(100vh - 120px);
      /* BaÅŸlÄ±k iÃ§in yÃ¼kseklik ayarlandÄ± */
    }

    .area {
      border-radius: 25px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      background: rgba(255, 255, 255, 0.2);
      border: 2px dashed var(--accent);
    }

    .board {
      background: rgba(255, 255, 255, 0.4);
      border: 3px solid var(--accent);
    }

    .card {
      width: 75px;
      height: 110px;
      background: var(--card-bg);
      border: 2px solid var(--primary);
      border-radius: 12px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 8px;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: all 0.2s;
    }

    .card:hover {
      transform: translateY(-10px);
      border-color: var(--primary-dark);
    }

    .card.red {
      color: #eb2f96;
    }

    .card.black {
      color: #2d001a;
    }

    .card.back {
      background: linear-gradient(45deg, var(--primary), var(--accent));
      border-color: #fff;
    }

    .rank {
      font-weight: bold;
      font-size: 1.1rem;
    }

    .suit {
      font-size: 1.4rem;
      align-self: flex-end;
    }

    .pile-container {
      position: relative;
      width: 80px;
      height: 115px;
    }

    .pile-card {
      position: absolute;
      top: 0;
      left: 0;
      transition: all 0.4s ease;
    }

    .stats {
      position: absolute;
      left: 15px;
      top: 15px;
      background: white;
      padding: 12px;
      border-radius: 15px;
      box-shadow: var(--shadow);
      font-size: 0.85rem;
      z-index: 10;
    }

    .msg-box {
      position: absolute;
      bottom: 15px;
      background: var(--primary);
      color: white;
      padding: 8px 25px;
      border-radius: 20px;
      font-weight: bold;
      display: none;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    button {
      background: var(--primary-dark);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 5px;
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background-color: var(--primary);
      top: -20px;
      z-index: 9999;
      border-radius: 2px;
      animation: fall linear forwards;
    }

    @keyframes fall {
      to {
        transform: translateY(105vh) rotate(720deg);
      }
    }

    /* Kazanan MesajÄ± Paneli (Alert yerine bu daha ÅŸÄ±k durur) */
    #win-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 0 50px rgba(247, 89, 171, 0.5);
      z-index: 10000;
      text-align: center;
      display: none;
      border: 5px solid var(--primary);
    }
  </style>
</head>

<body>

  <div class="game-header">
    <h1>ðŸ’– PÄ°ÅžTÄ° ðŸ’– </h1>
  </div>

  <div class="game-container">
    <div class="area">
      <div id="ai-cards" style="display: flex; gap: 8px;"></div>
    </div>

    <div class="area board">
      <div class="stats">
        <b>ðŸ“Š Skor Tablosu</b><br>
        Siz: <span id="p-score">0</span> | Kart: <span id="p-count">0</span><br>
        Bilgisayar: <span id="a-score">0</span> | Kart: <span id="a-count">0</span>
        <hr>
        Deste: <span id="deck-left">52</span><br>
        <button onclick="initGame()">Yenile</button>
      </div>

      <div class="pile-container" id="pile-ui"></div>
      <div id="msg" class="msg-box"></div>
    </div>

    <div class="area">
      <div id="player-cards" style="display: flex; gap: 8px;"></div>
    </div>
  </div>

  <script>
    const suits = ['â™ ', 'â™£', 'â™¥', 'â™¦'];
    const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];

    let deck = [], pile = [], playerHand = [], aiHand = [];
    let pCaptured = [], aCaptured = [], pScore = 0, aScore = 0;
    let turn = 'player', lastWinner = 'player';

    function createDeck() {
      deck = [];
      for (let s of suits) {
        for (let r of ranks) {
          deck.push({ suit: s, rank: r, color: (s === 'â™¥' || s === 'â™¦') ? 'red' : 'black' });
        }
      }
      deck = deck.sort(() => Math.random() - 0.5);
    }

    function getCardPoints(card) {
      if (card.rank === 'A' || card.rank === 'J') return 1;
      if (card.rank === '2' && card.suit === 'â™£') return 2;
      if (card.rank === '10' && card.suit === 'â™¦') return 3;
      return 0;
    }

    function updateUI() {
      document.getElementById('player-cards').innerHTML = playerHand.map((c, i) =>
        `<div onclick="playCard(${i})">${renderCard(c)}</div>`).join('');

      document.getElementById('ai-cards').innerHTML = aiHand.map(() => renderCard({}, true)).join('');

      const pileUI = document.getElementById('pile-ui');
      pileUI.innerHTML = '';
      pile.forEach((c, i) => {
        const cardDiv = document.createElement('div');
        cardDiv.className = 'pile-card';
        cardDiv.style.left = (i * 2) + 'px';
        cardDiv.style.transform = `rotate(${i * 3}deg)`;
        cardDiv.innerHTML = (i === pile.length - 1) ? renderCard(c) : renderCard({}, true);
        pileUI.appendChild(cardDiv);
      });

      document.getElementById('p-score').innerText = pScore;
      document.getElementById('a-score').innerText = aScore;
      document.getElementById('p-count').innerText = pCaptured.length;
      document.getElementById('a-count').innerText = aCaptured.length;
      document.getElementById('deck-left').innerText = deck.length;
    }

    function renderCard(card, back = false) {
      if (back) return `<div class="card back"></div>`;
      return `<div class="card ${card.color}"><div class="rank">${card.rank}</div><div class="suit">${card.suit}</div></div>`;
    }

    function playCard(idx) {
      if (turn !== 'player' || playerHand.length === 0) return;
      const card = playerHand.splice(idx, 1)[0];
      handleMove(card, 'player');
      turn = 'ai';
      setTimeout(aiPlay, 800);
      updateUI();
    }

    function aiPlay() {
      if (aiHand.length === 0) return;
      const top = pile[pile.length - 1];
      let idx = aiHand.findIndex(c => top && (c.rank === top.rank || c.rank === 'J'));
      if (idx === -1) idx = Math.floor(Math.random() * aiHand.length);

      const card = aiHand.splice(idx, 1)[0];
      handleMove(card, 'ai');
      turn = 'player';
      checkAndDeal();
      updateUI();
    }

    function handleMove(card, side) {
      const top = pile[pile.length - 1];

      // Kart alma durumu (EÅŸleÅŸme veya Vale)
      if (top && (card.rank === top.rank || card.rank === 'J')) {
        let moveScore = 0;
        let capturedCards = [...pile, card]; // AtÄ±lan kart + yerdekiler

        // --- PÄ°ÅžTÄ° KONTROLÃœ ---
        // Yerde sadece 1 kart varsa ve atÄ±lan kart onunla aynÄ±ysa (Vale ile piÅŸti olmaz, Vale sadece Vale ile piÅŸti yapar)
        if (pile.length === 1 && card.rank === top.rank) {
          moveScore = (card.rank === 'J') ? 20 : 10;
          showMsg("ðŸŒ¸ PÄ°ÅžTÄ°! +" + moveScore);
        } else {
          showMsg(side === 'player' ? "AldÄ±nÄ±z!" : "Bilgisayar aldÄ±!");
        }

        // --- PUAN HESAPLAMA ---
        // Her durumda yerdeki kartlarÄ±n iÃ§indeki Ã¶zel puanlÄ± kartlarÄ± topla
        capturedCards.forEach(c => {
          moveScore += getCardPoints(c);
        });

        // PuanlarÄ± ve kartlarÄ± ilgili tarafa iÅŸle
        if (side === 'player') {
          pScore += moveScore;
          pCaptured.push(...capturedCards);
        } else {
          aScore += moveScore;
          aCaptured.push(...capturedCards);
        }

        pile = [];
        lastWinner = side;
      } else {
        // Kart yerdeki desteye eklenir
        pile.push(card);
      }
    }

    function checkAndDeal() {
      if (playerHand.length === 0 && aiHand.length === 0) {
        if (deck.length > 0) {
          setTimeout(() => { deal(); updateUI(); }, 400);
        } else {
          finishGame();
        }
      }
    }

    function deal() {
      playerHand = deck.splice(0, 4);
      aiHand = deck.splice(0, 4);
    }

    function showMsg(txt) {
      const m = document.getElementById('msg');
      m.innerText = txt;
      m.style.display = 'block';
      setTimeout(() => { m.style.display = 'none'; }, 1500);
    }

    function finishGame() {
        if (pile.length > 0) {
            let remainingPoints = 0;
            pile.forEach(c => remainingPoints += getCardPoints(c));
            if (lastWinner === 'player') { pCaptured.push(...pile); pScore += remainingPoints; }
            else { aCaptured.push(...pile); aScore += remainingPoints; }
            pile = [];
        }
        
        if (pCaptured.length > aCaptured.length) pScore += 3;
        else if (aCaptured.length > pCaptured.length) aScore += 3;

        updateUI();

        // SonuÃ§ ekranÄ±nÄ± hazÄ±rla
        const modal = document.getElementById('win-modal');
        const title = document.getElementById('win-title');
        const details = document.getElementById('win-details');
        
        if (pScore > aScore) {
            title.innerText = " TEBRÄ°KLER, KAZANDINIZ! ";
            createConfetti(); // Animasyonu baÅŸlat
        } else if (pScore < aScore) {
            title.innerText = "ÃœzÃ¼ldÃ¼k, Bilgisayar KazandÄ±!";
        } else {
            title.innerText = "Dostluk KazandÄ±! (Berabere)";
        }
        
        details.innerText = `Sizin PuanÄ±nÄ±z: ${pScore}\nBilgisayarÄ±n PuanÄ±: ${aScore}`;
        setTimeout(() => { modal.style.display = 'block'; }, 500);
    }

    function createConfetti() {
        for (let i = 0; i < 100; i++) {
            const c = document.createElement('div');
            c.className = 'confetti';
            c.style.left = Math.random() * 100 + 'vw';
            c.style.backgroundColor = ['#ff85c0', '#f759ab', '#ffadd2', '#780650'][Math.floor(Math.random() * 4)];
            c.style.animationDuration = (Math.random() * 3 + 2) + 's';
            c.style.opacity = Math.random();
            document.body.appendChild(c);
            
            // Animasyon bitince temizle
            setTimeout(() => c.remove(), 5000);
        }
    }

    function closeWinModal() {
        document.getElementById('win-modal').style.display = 'none';
        initGame();
    }

    function initGame() {
      createDeck();
      pCaptured = []; aCaptured = []; pScore = 0; aScore = 0;
      pile = deck.splice(0, 4);
      deal();
      turn = 'player';
      updateUI();
    }

    initGame();
  </script>
  <div id="win-modal">
    <h1 id="win-title" style="color: var(--primary-dark); margin-bottom: 5px;"> TEBRÄ°KLER </h1>
    <p id="win-details" style="font-size: 1.2rem;"></p>
    <button onclick="closeWinModal()" style="padding: 10px 30px; font-size: 1rem;">Tekrar Oyna</button>
</div>
</body>

</html>